---
applyTo: "*Test.java"
---

# 单元测试编写规范

## 基本要求

- 测试类命名以 *Test 结尾，位于 test 包对应目录
- 使用 JUnit 5 + Mockito，测试覆盖率目标 80%+
- 每个测试方法只验证一个功能点，遵循 AAA（Arrange-Act-Assert）结构
- 测试类与方法必须编写 JEP 467 Markdown 文档注释（`///`），说明场景、输入、预期
- 使用静态导入简化断言和 Mockito 验证

## 命名规约

- 测试类：`被测类名 + Test`
- 测试方法（推荐）：`should + 预期结果 + When + 条件`
- 简单场景可用：`test + 方法名`（仅限单一分支）
- Mock 对象命名：`mock + 类名`

## 结构与模式

- AAA 模式：Arrange 准备数据和 Mock → Act 执行被测方法 → Assert 验证结果/交互
- 避免多个断言覆盖不同行为，应拆分测试用例
- 对外部依赖使用 Mockito/Stub，保持测试可重复、可预测

## 数据与状态

- 测试数据使用 Builder/Fixture 工具集中构建，避免重复代码
- 禁止测试间共享可变状态；使用 @BeforeEach 初始化隔离数据
- 需要容器或嵌入式存储时，统一复用模块基类提供的容器配置

## 断言与验证

- 断言优先使用 AssertJ（`assertThat` 系列）；异常使用 `assertThrows`
- 验证外部交互使用 Mockito 校验调用次数与参数
- 避免仅验证调用而缺少结果断言

## 覆盖与场景

- 覆盖正常流程、边界条件和异常分支
- 对空集合、空结果与错误码等约定行为要有对应测试
- 参数校验应有专门用例验证 Bean Validation 或手工校验逻辑

## 文档与维护

- 接口/需求变更时同步更新测试与注释
- 统一格式化与静态检查（spotless/maven），保持风格一致
- 禁止在单元测试中编写与业务无关的示例或冗余代码
