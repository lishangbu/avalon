databaseChangeLog:
  - changeSet:
      id: '创建认证相关表'
      author: lishangbu
      dbms: postgresql
      changes:
        - createTable:
            tableName: menu
            remarks: '菜单'
            columns:
              - column:
                  name: id
                  type: serial4
                  constraints:
                    primaryKey: true
                    nullable: false
                  remarks: '主键'
              - column:
                  name: parent_id
                  type: int4
                  remarks: '父菜单ID'
              - column:
                  name: disabled
                  type: boolean
                  remarks: '是否禁用菜单项'
              - column:
                  name: extra
                  type: varchar(500)
                  remarks: '菜单项的额外部分'
              - column:
                  name: icon
                  type: varchar(200)
                  remarks: '菜单项的图标'
              - column:
                  name: key
                  type: varchar(200)
                  remarks: '菜单项的标识符'
              - column:
                  name: label
                  type: varchar(200)
                  remarks: '菜单项的内容'
              - column:
                  name: show
                  type: boolean
                  remarks: '是否显示菜单项'
              - column:
                  name: path
                  type: varchar(500)
                  remarks: '路径'
              - column:
                  name: name
                  type: varchar(500)
                  remarks: '名称'
              - column:
                  name: redirect
                  type: varchar(500)
                  remarks: '重定向路径'
              - column:
                  name: component
                  type: varchar(500)
                  remarks: '组件路径'
              - column:
                  name: sort_order
                  type: int4
                  remarks: '排序顺序'
                  defaultValue: '0'
              - column:
                  name: pinned
                  type: bool
                  remarks: '是否固定标签页'
                  defaultValue: 'false'
              - column:
                  name: show_tab
                  type: bool
                  remarks: '是否显示标签页'
                  defaultValue: 'true'
              - column:
                  name: enable_multi_tab
                  type: bool
                  remarks: '是否支持多标签页'
                  defaultValue: 'false'
        - createTable:
            tableName: oauth_authorization
            remarks: '用户认证信息表'
            columns:
              - column:
                  name: id
                  type: varchar(100)
                  constraints:
                    primaryKey: true
                    nullable: false
                  remarks: "唯一标识符"
              - column:
                  name: registered_client_id
                  type: varchar(100)
                  constraints:
                    nullable: false
                  remarks: "已注册的客户端ID"
              - column:
                  name: principal_name
                  type: varchar(200)
                  constraints:
                    nullable: false
                  remarks: "主体名称"
              - column:
                  name: authorization_grant_type
                  type: varchar(100)
                  constraints:
                    nullable: false
                  remarks: "授权方式"
              - column:
                  name: authorized_scopes
                  type: varchar(1000)
                  constraints:
                    nullable: true
                  remarks: "授权范围"
              - column:
                  name: attributes
                  type: jsonb
                  constraints:
                    nullable: true
                  remarks: "属性"
              - column:
                  name: state
                  type: varchar(500)
                  constraints:
                    nullable: true
                  remarks: "状态"
              - column:
                  name: authorization_code_value
                  type: varchar(1000)
                  constraints:
                    nullable: true
                  remarks: "授权码值"
              - column:
                  name: authorization_code_issued_at
                  type: timestamptz
                  constraints:
                    nullable: true
                  remarks: "授权码签发时间"
              - column:
                  name: authorization_code_expires_at
                  type: timestamptz
                  constraints:
                    nullable: true
                  remarks: "授权码过期时间"
              - column:
                  name: authorization_code_metadata
                  type: jsonb
                  constraints:
                    nullable: true
                  remarks: "授权码元数据"
              - column:
                  name: access_token_value
                  type: varchar(1000)
                  constraints:
                    nullable: true
                  remarks: "访问令牌值"
              - column:
                  name: access_token_issued_at
                  type: timestamptz
                  constraints:
                    nullable: true
                  remarks: "访问令牌签发时间"
              - column:
                  name: access_token_expires_at
                  type: timestamptz
                  constraints:
                    nullable: true
                  remarks: "访问令牌过期时间"
              - column:
                  name: access_token_metadata
                  type: jsonb
                  constraints:
                    nullable: true
                  remarks: "访问令牌元数据"
              - column:
                  name: access_token_type
                  type: varchar(100)
                  constraints:
                    nullable: true
                  remarks: "访问令牌类型"
              - column:
                  name: access_token_scopes
                  type: varchar(1000)
                  constraints:
                    nullable: true
                  remarks: "访问令牌范围"
              - column:
                  name: oidc_id_token_value
                  type: varchar(1000)
                  constraints:
                    nullable: true
                  remarks: "OIDC ID 令牌值"
              - column:
                  name: oidc_id_token_issued_at
                  type: timestamptz
                  constraints:
                    nullable: true
                  remarks: "OIDC ID 令牌签发时间"
              - column:
                  name: oidc_id_token_expires_at
                  type: timestamptz
                  constraints:
                    nullable: true
                  remarks: "OIDC ID 令牌过期时间"
              - column:
                  name: oidc_id_token_metadata
                  type: jsonb
                  constraints:
                    nullable: true
                  remarks: "OIDC ID 令牌元数据"
              - column:
                  name: refresh_token_value
                  type: varchar(1000)
                  constraints:
                    nullable: true
                  remarks: "刷新令牌值"
              - column:
                  name: refresh_token_issued_at
                  type: timestamptz
                  constraints:
                    nullable: true
                  remarks: "刷新令牌签发时间"
              - column:
                  name: refresh_token_expires_at
                  type: timestamptz
                  constraints:
                    nullable: true
                  remarks: "刷新令牌过期时间"
              - column:
                  name: refresh_token_metadata
                  type: jsonb
                  constraints:
                    nullable: true
                  remarks: "刷新令牌元数据"
              - column:
                  name: user_code_value
                  type: varchar(1000)
                  constraints:
                    nullable: true
                  remarks: "用户代码值"
              - column:
                  name: user_code_issued_at
                  type: timestamptz
                  constraints:
                    nullable: true
                  remarks: "用户代码签发时间"
              - column:
                  name: user_code_expires_at
                  type: timestamptz
                  constraints:
                    nullable: true
                  remarks: "用户代码过期时间"
              - column:
                  name: user_code_metadata
                  type: jsonb
                  constraints:
                    nullable: true
                  remarks: "用户代码元数据"
              - column:
                  name: device_code_value
                  type: varchar(1000)
                  constraints:
                    nullable: true
                  remarks: "设备代码值"
              - column:
                  name: device_code_issued_at
                  type: timestamptz
                  constraints:
                    nullable: true
                  remarks: "设备代码签发时间"
              - column:
                  name: device_code_expires_at
                  type: timestamptz
                  constraints:
                    nullable: true
                  remarks: "设备代码过期时间"
              - column:
                  name: device_code_metadata
                  type: jsonb
                  constraints:
                    nullable: true
                  remarks: "设备代码元数据"
        - createTable:
            tableName: oauth_authorization_consent
            remarks: '用户授权确认表'
            columns:
              - column:
                  name: registered_client_id
                  type: varchar(100)
                  remarks: '当前授权确认的客户端id'
                  constraints:
                    primaryKey: true
                    nullable: false
              - column:
                  name: principal_name
                  type: varchar(200)
                  remarks: '当前授权确认用户的 username'
                  constraints:
                    primaryKey: true
                    nullable: false
              - column:
                  name: authorities
                  type: varchar(1000)
                  remarks: '授权确认的scope'
                  constraints:
                    nullable: false
        - createTable:
            tableName: oauth_registered_client
            remarks: 'Oauth2注册客户端'
            columns:
              - column:
                  name: id
                  type: varchar(100)
                  constraints:
                    primaryKey: true
                    nullable: false
                  remarks: "唯一标识符"
              - column:
                  name: client_id
                  type: varchar(100)
                  constraints:
                    nullable: false
                  remarks: "客户端 ID"
              - column:
                  name: client_id_issued_at
                  type: timestamptz
                  constraints:
                    nullable: false
                  remarks: "客户端 ID 签发时间"
              - column:
                  name: client_secret
                  type: varchar(200)
                  constraints:
                    nullable: true
                  remarks: "客户端密钥"
              - column:
                  name: client_secret_expires_at
                  type: timestamptz
                  constraints:
                    nullable: true
                  remarks: "客户端密钥过期时间"
              - column:
                  name: client_name
                  type: varchar(200)
                  constraints:
                    nullable: false
                  remarks: "客户端名称"
              - column:
                  name: client_authentication_methods
                  type: varchar(1000)
                  constraints:
                    nullable: false
                  remarks: "客户端认证方式"
              - column:
                  name: authorization_grant_types
                  type: varchar(1000)
                  constraints:
                    nullable: false
                  remarks: "授权方式"
              - column:
                  name: redirect_uris
                  type: varchar(1000)
                  constraints:
                    nullable: true
                  remarks: "重定向 URI"
              - column:
                  name: post_logout_redirect_uris
                  type: varchar(1000)
                  constraints:
                    nullable: true
                  remarks: "登出后的重定向 URI"
              - column:
                  name: scopes
                  type: varchar(1000)
                  constraints:
                    nullable: false
                  remarks: "客户端授权的范围"
              - column:
                  name: require_proof_key
                  type: bool
                  remarks: '当使用该客户端发起PKCE流程时必须设置为true,默认为false'
                  defaultValue: 'false'
                  constraints:
                    nullable: false
              - column:
                  name: require_authorization_consent
                  type: bool
                  remarks: '当设置为true时登录后会先跳转授权确认页面，确认后才会跳转到redirect_uri，为false时不会跳转至授权确认页面，默认为false'
                  defaultValue: 'false'
                  constraints:
                    nullable: false
              - column:
                  name: jwk_set_url
                  type: varchar(1000)
                  remarks: "设置客户端jwks的url"
              - column:
                  name: token_endpoint_authentication_signing_algorithm
                  type: varchar(20)
                  remarks: '设置token端点对验证方法为CLIENT_SECRET_JWT，PRIVATE_KEY_JWT的客户端进行身份验证使用的签名算法'
              - column:
                  name: x509_certificate_subject_dn
                  type: varchar(20)
                  remarks: 'the expected subject distinguished name associated to the client X509Certificate received during client authentication when using the tls_client_auth method'
              - column:
                  name: authorization_code_time_to_live
                  type: varchar(20)
                  remarks: '授权码(authorization_code)有效时长,默认五分钟'
                  defaultValue: '5m'
                  constraints:
                    nullable: false
              - column:
                  name: access_token_time_to_live
                  type: varchar(20)
                  remarks: 'access_token有效时长,默认五分钟'
                  defaultValue: '5m'
                  constraints:
                    nullable: false
              - column:
                  name: access_token_format
                  type: varchar(20)
                  remarks: 'access_token的格式，SELF_CONTAINED是自包含token(jwt格式)，REFERENCE是不透明token，相当于是token元数据的一个id，通过id找到对应数据(自省令牌时)'
                  defaultValue: 'self-contained'
                  constraints:
                    nullable: false
              - column:
                  name: device_code_time_to_live
                  type: varchar(20)
                  remarks: '设备码有效时长,默认五分钟'
                  defaultValue: '5m'
                  constraints:
                    nullable: false
              - column:
                  name: reuse_refresh_tokens
                  type: bool
                  remarks: '刷新token时是否重用refresh token，设置为true后refresh token不变，false刷新token时会重新签发一个refresh token，默认是true'
                  defaultValue: 'true'
                  constraints:
                    nullable: false
              - column:
                  name: refresh_token_time_to_live
                  type: varchar(20)
                  remarks: 'refresh_token有效时长,默认一小时'
                  defaultValue: '1h'
                  constraints:
                    nullable: false
              - column:
                  name: id_token_signature_algorithm
                  type: varchar(20)
                  remarks: 'the JWS algorithm for signing the ID Token. The default is RS256.'
                  defaultValue: 'RS256'
                  constraints:
                    nullable: false
              - column:
                  name: x509_certificate_bound_access_tokens
                  type: bool
                  remarks: 'true if access tokens must be bound to the client X509Certificate received during client authentication when using the tls_client_auth or self_signed_tls_client_auth method. The default is false.'
                  defaultValue: 'false'
                  constraints:
                    nullable: false
        - createTable:
            tableName: role
            remarks: '角色信息'
            columns:
              - column:
                  name: id
                  type: serial4
                  constraints:
                    primaryKey: true
                    nullable: false
                  remarks: '主键'
              - column:
                  name: code
                  type: varchar(50)
                  constraints:
                    nullable: false
                    unique: true
                  defaultValue: ''
                  remarks: '角色代码'
              - column:
                  name: name
                  type: varchar(50)
                  constraints:
                    nullable: false
                  defaultValue: ''
                  remarks: '角色名称'
              - column:
                  name: enabled
                  type: boolean
                  constraints:
                    nullable: false
                  defaultValue: 'true'
                  remarks: '角色是否启用'
        - createTable:
            tableName: role_menu_relation
            remarks: '角色菜单关系'
            columns:
              - column:
                  name: role_id
                  type: int4
                  constraints:
                    nullable: false
                  remarks: '角色ID'
              - column:
                  name: menu_id
                  type: int4
                  constraints:
                    nullable: false
                  remarks: '菜单ID'
        - createTable:
            tableName: user
            remarks: '用户信息'
            columns:
              - column:
                  name: id
                  type: serial4
                  constraints:
                    primaryKey: true
                    nullable: false
                  remarks: '主键'
              - column:
                  name: username
                  type: varchar(20)
                  constraints:
                    nullable: false
                    unique: true
                  defaultValue: ''
                  remarks: '用户名'
              - column:
                  name: password
                  type: varchar(100)
                  constraints:
                    nullable: false
                  defaultValue: ''
                  remarks: '密码'
        - createTable:
            tableName: user_role_relation
            remarks: '用户角色关系'
            columns:
              - column:
                  name: user_id
                  type: int4
                  constraints:
                    nullable: false
                  remarks: '用户ID'
              - column:
                  name: role_id
                  type: int4
                  constraints:
                    nullable: false
                  remarks: '角色ID'
